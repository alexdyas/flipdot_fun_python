#!/usr/bin/python3

# https://xantorohara.github.io/led-matrix-editor/#007e7f09097f7e00|007f7f49497f3600|003e7f4141632200|007f7f41417f3e00|007f7f4949494100|007f7f0909090100|003e7f4151733200|007f7f08087f7f00|0000417f7f410000|003070417f3f0100|007f7f1c36634100|007f7f4040404000|007f7f060c067f7f|007f7f060c187f7f|003e7f41417f3e00|007f7f11111f0e00|001e3f21317f5e00|007f7f19396f4600|00266f49497b3200|0003017f7f010300|003f7f40407f7f00|001f3f60603f1f00|007f7f3018307f7f|0063771c081c7763|00070f78780f0700|006171594d474300|0000000000000000|7c667c603c000000|3e66663e06060600|3c6606663c000000|7c66667c60606000|3c067e663c000000|0c0c3e0c0c6c3800|3c607c66667c0000|6666663e06060600|3c18181800180000|1c36363030003000|66361e3666060600|1818181818181800|d6d6feeec6000000|6666667e3e000000|3c6666663c000000|06063e66663e0000|f0b03c36363c0000|060666663e000000|3e403c027c000000|1818187e18180000|7c66666666000000|183c666600000000|7cd6d6d6c6000000|663c183c66000000|3c607c6666000000|3c0c18303c000000

# Font tests

import serial
from serial import (
    PARITY_NONE,
    EIGHTBITS,
    STOPBITS_ONE,
)

import sys
import time

# Prepare the serial port
serialPort = serial.Serial('/dev/ttyUSB0')
serialPort.baudrate = 57600
serialPort.parity = PARITY_NONE
serialPort.bytesize = EIGHTBITS
serialPort.stopbits = STOPBITS_ONE
if serialPort.isOpen() :
  print("Port was open, reopening")
  serialPort.close()
serialPort.open()

# Initialise display byte array. The header and end of transmission bytes will never need to be changed, only the display bytes
display_array = bytearray([
    0x80,  # header
    0x83,  # 28 bytes refresh
    0xFF,  # display address, FF == all displays
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  # 28 bytes data
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x8F #EOT
])

# Capital letters
letters = { 'A' : [0x7e,0x7f,0x09,0x09,0x7f,0x7e],
            'B' : [0x7f,0x7f,0x49,0x49,0x7f,0x36],
            'C' : [0x3e,0x7f,0x41,0x41,0x63,0x22],
            'D' : [0x7f,0x7f,0x41,0x41,0x7f,0x3e],
            'E' : [0x7f,0x7f,0x49,0x49,0x49,0x41],
            'F' : [0x7f,0x7f,0x09,0x09,0x09,0x01],
            'G' : [0x3e,0x7f,0x41,0x51,0x73,0x32],
            'H' : [0x7f,0x7f,0x08,0x08,0x7f,0x7f],
            'I' : [0x00,0x41,0x7f,0x7f,0x41,0x00],
            'J' : [0x30,0x70,0x41,0x7f,0x3f,0x01],
            'K' : [0x7f,0x7f,0x1c,0x36,0x63,0x41],
            'L' : [0x7f,0x7f,0x40,0x40,0x40,0x40],
            'M' : [0x7f,0x7f,0x06,0x0c,0x06,0x7f,0x7f],
            'N' : [0x7f,0x7f,0x06,0x0c,0x18,0x7f,0x7f],
            'O' : [0x3e,0x7f,0x41,0x41,0x7f,0x3e,0x00],
            'P' : [0x7f,0x7f,0x11,0x11,0x1f,0x0e],
            'Q' : [0x1e,0x3f,0x21,0x31,0x7f,0x5e],
            'R' : [0x7f,0x7f,0x19,0x39,0x6f,0x46],
            'S' : [0x26,0x6f,0x49,0x49,0x7b,0x32],
            'T' : [0x03,0x01,0x7f,0x7f,0x01,0x03],
            'U' : [0x3f,0x7f,0x40,0x40,0x7f,0x7f],
            'V' : [0x1f,0x3f,0x60,0x60,0x3f,0x1f],
            'W' : [0x7f,0x7f,0x30,0x18,0x30,0x7f,0x7f],
            'X' : [0x63,0x77,0x1c,0x08,0x1c,0x77,0x63],
            'Y' : [0x07,0x0f,0x78,0x78,0x0f,0x07],
            'Z' : [0x61,0x71,0x59,0x4d,0x47,0x43],
            'a' : [0x20,0x74,0x54,0x54,0x7c,0x78],
            'b' : [0x7f,0x7f,0x48,0x48,0x78,0x30],
            'c' : [0x38,0x7c,0x44,0x44,0x6c,0x28],
            'd' : [0x30,0x78,0x48,0x48,0x7f,0x7f],
            'e' : [0x38,0x7c,0x54,0x54,0x5c,0x18],
            'f' : [0x10,0x7e,0x7f,0x11,0x13,0x02],
            'g' : [0x0c,0x5e,0x52,0x52,0x7e,0x3e],
            'h' : [0x7f,0x7f,0x08,0x08,0x78,0x70],
            'i' : [0x00,0x40,0x7a,0x7a,0x40,0x00],
            'j' : [0x30,0x70,0x40,0x7d,0x3d,0x00],
            'k' : [0x7f,0x7f,0x10,0x38,0x6c,0x44],
            'l' : [0x00,0x00,0x7f,0x7f,0x00,0x00],
            'm' : [0x7c,0x7c,0x18,0x70,0x18,0x7c,0x7c],
            'n' : [0x7c,0x7c,0x0c,0x0c,0x7c,0x78],
            'o' : [0x38,0x7c,0x44,0x44,0x7c,0x38],
            'p' : [0x7e,0x7e,0x12,0x12,0x1e,0x0c],
            'q' : [0x0c,0x1e,0x12,0x7e,0x7e,0x40,0x60],
            'r' : [0x7c,0x7c,0x04,0x04,0x1c,0x18],
            's' : [0x48,0x54,0x54,0x54,0x54,0x24],
            't' : [0x08,0x08,0x7e,0x7e,0x08,0x08],
            'u' : [0x3c,0x7c,0x40,0x40,0x7c,0x7c],
            'v' : [0x18,0x38,0x60,0x60,0x38,0x18],
            'w' : [0x3c,0x7c,0x40,0x78,0x40,0x7c,0x3c],
            'x' : [0x44,0x6c,0x38,0x38,0x6c,0x44],
            'y' : [0x0c,0x5c,0x50,0x50,0x7c,0x3c],
            'z' : [0x00,0x64,0x74,0x5c,0x4c,0x00],
            '1' : [0x40,0x44,0x7f,0x7f,0x40,0x40],
            '2' : [0x62,0x73,0x51,0x49,0x4f,0x46],
            '3' : [0x22,0x63,0x49,0x49,0x7f,0x36],
            '4' : [0x18,0x14,0x12,0x7f,0x7f,0x10],
            '5' : [0x27,0x67,0x45,0x45,0x7d,0x39],
            '6' : [0x3e,0x7f,0x49,0x49,0x7b,0x32],
            '7' : [0x03,0x03,0x71,0x7d,0x0f,0x03],
            '8' : [0x36,0x7f,0x49,0x49,0x7f,0x36],
            '9' : [0x26,0x6f,0x49,0x49,0x7f,0x3e],
            '0' : [0x3e,0x7f,0x49,0x45,0x7f,0x3e]

def letter_at(pos,letter) :
  for x in range(len(letters[letter])) :
    display_array[x+pos+3] = letters[letter][x]

serialPort.write(display_array)

letter_at(0,'i')
letter_at(7,'I')
letter_at(14,'o')
letter_at(21,'p')

serialPort.write(display_array)